<mxfile host="app.diagrams.net" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36 Edg/138.0.0.0" version="28.0.9">
  <diagram name="AWS MongoDB Lambda Phase 3 - API Gateway" id="aws-mongo-lambda-phase3">
    <mxGraphModel dx="2826" dy="786" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1169" pageHeight="827" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="internet" value="Internet Users" style="ellipse;shape=cloud;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=14;fontStyle=1;" parent="1" vertex="1">
          <mxGeometry x="-90" y="20" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="aws-cloud" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;strokeWidth=2;dashed=1;" parent="1" vertex="1">
          <mxGeometry x="-150" y="150" width="1310" height="600" as="geometry" />
        </mxCell>
        <mxCell id="aws-label" value="AWS Cloud - PHASE 3: API Gateway + Private Backend" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=16;fontStyle=1;" parent="1" vertex="1">
          <mxGeometry x="70" y="160" width="400" height="30" as="geometry" />
        </mxCell>
        <mxCell id="api-gateway" value="API Gateway&#xa;mongo-api&#xa;&#xa;PUBLIC ENDPOINT&#xa;&#xa;Methods:&#xa;POST /mongo&#xa;OPTIONS /mongo&#xa;&#xa;Stage: prod" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;fontStyle=1;" parent="1" vertex="1">
          <mxGeometry x="-110" y="210" width="160" height="150" as="geometry" />
        </mxCell>
        <mxCell id="vpc" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;strokeWidth=2;dashed=1;" parent="1" vertex="1">
          <mxGeometry x="110" y="220" width="1010" height="480" as="geometry" />
        </mxCell>
        <mxCell id="vpc-label" value="VPC: mongo-vpc (PRIVATE)&#xa;CIDR: 10.0.0.0/16" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1;" parent="1" vertex="1">
          <mxGeometry x="340" y="230" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="subnet" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;strokeWidth=2;dashed=1;" parent="1" vertex="1">
          <mxGeometry x="170" y="280" width="910" height="390" as="geometry" />
        </mxCell>
        <mxCell id="subnet-label" value="Private Subnet: 10.0.1.0/24" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1;" parent="1" vertex="1">
          <mxGeometry x="370" y="290" width="200" height="30" as="geometry" />
        </mxCell>
        <mxCell id="lambda" value="Lambda Function&#xa;mongo-client&#xa;&#xa;Runtime: Python 3.9&#xa;API Gateway Integration&#xa;&#xa;Environment:&#xa;MONGO_HOST=10.0.1.x&#xa;&#xa;Features:&#xa;- HTTP event handling&#xa;- CORS headers&#xa;- JSON parsing" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=10;fontStyle=1;" parent="1" vertex="1">
          <mxGeometry x="210" y="330" width="180" height="180" as="geometry" />
        </mxCell>
        <mxCell id="ec2" value="EC2 Instance&#xa;mongo-server-private&#xa;&#xa;Type: t2.micro&#xa;OS: Ubuntu 20.04&#xa;MongoDB: 6.0&#xa;&#xa;PRIVATE ONLY&#xa;No Public IP&#xa;No SSH Access" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=10;fontStyle=1;" parent="1" vertex="1">
          <mxGeometry x="680" y="340" width="160" height="150" as="geometry" />
        </mxCell>
        <mxCell id="mongodb" value="MongoDB&#xa;Port: 27017&#xa;&#xa;Database: testdb&#xa;Collection: testcol&#xa;&#xa;PRIVATE ONLY" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="720" y="560" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="lambda-layer" value="Lambda Layer&#xa;pymongo&#xa;&#xa;Python 3.9&#xa;Dependencies" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="210" y="560" width="180" height="60" as="geometry" />
        </mxCell>
        <mxCell id="sg-lambda" value="Lambda SG&#xa;&#xa;Out: 27017&#xa;to EC2 SG" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=9;" parent="1" vertex="1">
          <mxGeometry x="390" y="490" width="80" height="60" as="geometry" />
        </mxCell>
        <mxCell id="sg-ec2" value="EC2 SG&#xa;&#xa;In: 27017&#xa;from Lambda SG" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=9;" parent="1" vertex="1">
          <mxGeometry x="850" y="490" width="80" height="60" as="geometry" />
        </mxCell>
        <mxCell id="iam-role" value="IAM Role&#xa;mongo-lambda-role&#xa;&#xa;VPC Access&#xa;CloudWatch Logs" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=9;" parent="1" vertex="1">
          <mxGeometry x="545" y="300" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="conn1" value="HTTPS" style="endArrow=classic;html=1;rounded=0;strokeWidth=3;strokeColor=#9673a6;" parent="1" source="internet" target="api-gateway" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="110" y="110" as="sourcePoint" />
            <mxPoint x="180" y="220" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="conn2" value="AWS_PROXY" style="endArrow=classic;html=1;rounded=0;strokeWidth=3;strokeColor=#d6b656;" parent="1" source="api-gateway" target="lambda" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="260" y="280" as="sourcePoint" />
            <mxPoint x="380" y="410" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="conn3" value="10.0.1.x:27017" style="endArrow=classic;html=1;rounded=0;strokeWidth=3;strokeColor=#82b366;" parent="1" source="lambda" target="mongodb" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="560" y="450" as="sourcePoint" />
            <mxPoint x="720" y="540" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="conn4" value="localhost" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#d79b00;" parent="1" source="ec2" target="mongodb" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="760" y="460" as="sourcePoint" />
            <mxPoint x="760" y="500" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="conn5" value="Attached" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#9673a6;dashed=1;" parent="1" source="lambda-layer" target="lambda" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="470" y="520" as="sourcePoint" />
            <mxPoint x="470" y="480" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="conn6" value="Assumes" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#9673a6;dashed=1;" parent="1" source="iam-role" target="lambda" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="870" y="540" as="sourcePoint" />
            <mxPoint x="560" y="450" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="api-components" value="API Components:&#xa;&#xa;REST API: mongo-api&#xa;Resource: /mongo&#xa;Method: POST&#xa;Integration: AWS_PROXY&#xa;Deployment: prod&#xa;CORS: OPTIONS" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=9;" parent="1" vertex="1">
          <mxGeometry x="-100" y="390" width="160" height="100" as="geometry" />
        </mxCell>
        <mxCell id="crud-ops" value="CRUD via API:&#xa;&#xa;POST /mongo&#xa;{action: insert, data: {...}}&#xa;{action: find, query: {...}}&#xa;{action: update, ...}&#xa;{action: delete, ...}&#xa;&#xa;JSON responses&#xa;CORS headers" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=9;" parent="1" vertex="1">
          <mxGeometry x="-100" y="530" width="160" height="120" as="geometry" />
        </mxCell>
        <mxCell id="flow1" value="1. HTTPS Request" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=9;" parent="1" vertex="1">
          <mxGeometry x="50" y="130" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="flow2" value="2. Lambda Invoke" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=9;" parent="1" vertex="1">
          <mxGeometry x="80" y="310" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="flow3" value="3. MongoDB Query" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=9;" parent="1" vertex="1">
          <mxGeometry x="580" y="480" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="outputs" value="Outputs:&#xa;&#xa;ec2_private_ip: 10.0.1.x&#xa;lambda_function_name: mongo-client&#xa;api_gateway_invoke_url:&#xa;https://abc123.execute-api.&#xa;us-east-1.amazonaws.com/prod/mongo" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=9;" parent="1" vertex="1">
          <mxGeometry x="790" y="30" width="180" height="100" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
