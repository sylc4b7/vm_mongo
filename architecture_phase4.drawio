<mxfile host="app.diagrams.net" modified="2024-01-01T00:00:00.000Z" agent="5.0" etag="xxx" version="22.1.16" type="device">
  <diagram name="AWS MongoDB Lambda Phase 4 - SPA + CDN" id="aws-mongo-lambda-phase4">
    <mxGraphModel dx="1422" dy="794" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1169" pageHeight="827" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        
        <!-- Global Users -->
        <mxCell id="global-users" value="🌍 GLOBAL USERS" style="ellipse;shape=cloud;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=14;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="50" y="30" width="150" height="80" as="geometry" />
        </mxCell>

        <!-- AWS Cloud Container -->
        <mxCell id="aws-cloud" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;strokeWidth=2;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="50" y="150" width="1050" height="650" as="geometry" />
        </mxCell>
        <mxCell id="aws-label" value="AWS Cloud - PHASE 4: SPA + CDN + API Gateway + Private Backend" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=16;fontStyle=1;fontColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="70" y="160" width="600" height="30" as="geometry" />
        </mxCell>

        <!-- CloudFront CDN -->
        <mxCell id="cloudfront" value="CloudFront CDN&#xa;🌐 GLOBAL DISTRIBUTION&#xa;&#xa;Domain: d123456789.cloudfront.net&#xa;&#xa;Features:&#xa;• Global Edge Locations&#xa;• HTTPS Termination&#xa;• Static Asset Caching&#xa;• Custom Error Pages&#xa;• Gzip Compression&#xa;&#xa;Cache Behavior:&#xa;• HTML/CSS/JS cached&#xa;• API calls passed through" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=10;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="100" y="210" width="200" height="180" as="geometry" />
        </mxCell>

        <!-- S3 Static Website -->
        <mxCell id="s3-bucket" value="S3 Static Website&#xa;mongo-spa-xyz12345&#xa;&#xa;📁 STATIC HOSTING&#xa;&#xa;Files:&#xa;• index.html (SPA)&#xa;• CSS styles&#xa;• JavaScript code&#xa;&#xa;Features:&#xa;• Static Website Hosting&#xa;• Public Read Access&#xa;• Error Document: index.html&#xa;• SPA Routing Support" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=10;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="100" y="420" width="200" height="160" as="geometry" />
        </mxCell>

        <!-- API Gateway -->
        <mxCell id="api-gateway" value="API Gateway&#xa;mongo-api&#xa;&#xa;🔗 REST API ENDPOINT&#xa;&#xa;Methods:&#xa;• POST /mongo&#xa;• OPTIONS /mongo (CORS)&#xa;&#xa;Stage: prod&#xa;Integration: AWS_PROXY&#xa;&#xa;CORS Headers:&#xa;• Access-Control-Allow-Origin: *&#xa;• Access-Control-Allow-Methods&#xa;• Access-Control-Allow-Headers" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=10;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="350" y="210" width="200" height="180" as="geometry" />
        </mxCell>

        <!-- VPC Container -->
        <mxCell id="vpc" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;strokeWidth=2;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="600" y="210" width="450" height="550" as="geometry" />
        </mxCell>
        <mxCell id="vpc-label" value="VPC: mongo-vpc (PRIVATE BACKEND)&#xa;CIDR: 10.0.0.0/16" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1;fontColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="620" y="220" width="300" height="40" as="geometry" />
        </mxCell>

        <!-- Private Subnet -->
        <mxCell id="subnet" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;strokeWidth=2;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="630" y="270" width="390" height="460" as="geometry" />
        </mxCell>
        <mxCell id="subnet-label" value="Private Subnet: 10.0.1.0/24 - NO PUBLIC ACCESS" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1;fontColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="650" y="280" width="300" height="30" as="geometry" />
        </mxCell>

        <!-- Lambda Function -->
        <mxCell id="lambda" value="Lambda Function&#xa;mongo-client&#xa;&#xa;Runtime: Python 3.9&#xa;Handler: lambda_function_api.lambda_handler&#xa;Timeout: 30s&#xa;&#xa;🔗 API Gateway Integration&#xa;Environment: MONGO_HOST=10.0.1.x&#xa;&#xa;Enhanced Features:&#xa;• HTTP event handling&#xa;• CORS headers&#xa;• JSON request/response&#xa;• Error handling&#xa;• MongoDB CRUD operations" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=9;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="660" y="320" width="180" height="160" as="geometry" />
        </mxCell>

        <!-- EC2 Instance -->
        <mxCell id="ec2" value="EC2 Instance&#xa;mongo-server-private&#xa;&#xa;Type: t2.micro&#xa;OS: Ubuntu 20.04&#xa;MongoDB: 6.0&#xa;&#xa;🔒 COMPLETELY PRIVATE&#xa;❌ NO Public IP&#xa;❌ NO SSH Access&#xa;❌ NO Internet Access&#xa;✅ Private IP: 10.0.1.x" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=9;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="860" y="320" width="140" height="140" as="geometry" />
        </mxCell>

        <!-- MongoDB -->
        <mxCell id="mongodb" value="MongoDB&#xa;Port: 27017&#xa;&#xa;Database: testdb&#xa;Collection: testcol&#xa;&#xa;🔒 PRIVATE ONLY&#xa;Lambda Access Only&#xa;&#xa;Data Persistence&#xa;CRUD Operations" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="890" y="490" width="80" height="100" as="geometry" />
        </mxCell>

        <!-- Lambda Layer -->
        <mxCell id="lambda-layer" value="Lambda Layer&#xa;pymongo&#xa;&#xa;Runtime: Python 3.9&#xa;Dependencies:&#xa;- pymongo library&#xa;- JSON handling&#xa;- HTTP utilities" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="660" y="510" width="180" height="80" as="geometry" />
        </mxCell>

        <!-- Security Groups -->
        <mxCell id="sg-lambda" value="Lambda SG&#xa;&#xa;Inbound: None&#xa;Outbound:&#xa;• 27017 to EC2 SG" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=8;" vertex="1" parent="1">
          <mxGeometry x="660" y="620" width="80" height="60" as="geometry" />
        </mxCell>

        <mxCell id="sg-ec2" value="EC2 SG&#xa;&#xa;Inbound:&#xa;• 27017 from Lambda SG&#xa;Outbound: None" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=8;" vertex="1" parent="1">
          <mxGeometry x="920" y="620" width="80" height="60" as="geometry" />
        </mxCell>

        <!-- IAM Role -->
        <mxCell id="iam-role" value="IAM Role&#xa;mongo-lambda-role&#xa;&#xa;Policies:&#xa;• VPCAccessExecutionRole&#xa;&#xa;Permissions:&#xa;• VPC ENI management&#xa;• CloudWatch logs" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=8;" vertex="1" parent="1">
          <mxGeometry x="780" y="620" width="100" height="80" as="geometry" />
        </mxCell>

        <!-- SPA Features Box -->
        <mxCell id="spa-features" value="📱 SPA FEATURES:&#xa;&#xa;✅ MongoDB Dashboard&#xa;✅ Insert Documents&#xa;✅ Find/Search Documents&#xa;✅ Update Documents&#xa;✅ Delete Documents&#xa;✅ Connection Testing&#xa;✅ JSON Validation&#xa;✅ Error Handling&#xa;✅ Responsive Design&#xa;✅ Local Storage (API URL)&#xa;✅ Real-time Updates" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=9;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="100" y="610" width="200" height="140" as="geometry" />
        </mxCell>

        <!-- API Operations Box -->
        <mxCell id="api-operations" value="🔧 API OPERATIONS:&#xa;&#xa;POST /mongo&#xa;{&#xa;  action: 'insert',&#xa;  data: {...}&#xa;}&#xa;&#xa;{&#xa;  action: 'find',&#xa;  query: {...}&#xa;}&#xa;&#xa;{&#xa;  action: 'update',&#xa;  query: {...},&#xa;  update: {...}&#xa;}&#xa;&#xa;{&#xa;  action: 'delete',&#xa;  query: {...}&#xa;}" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=8;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="350" y="420" width="200" height="160" as="geometry" />
        </mxCell>

        <!-- Connection Lines -->
        <!-- Users to CloudFront -->
        <mxCell id="conn1" value="HTTPS Requests&#xa;(Global Users)" style="endArrow=classic;html=1;rounded=0;strokeWidth=4;strokeColor=#9673a6;" edge="1" parent="1" source="global-users" target="cloudfront">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="125" y="110" as="sourcePoint" />
            <mxPoint x="200" y="210" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- CloudFront to S3 -->
        <mxCell id="conn2" value="Origin Requests&#xa;(Static Assets)" style="endArrow=classic;html=1;rounded=0;strokeWidth=3;strokeColor=#82b366;" edge="1" parent="1" source="cloudfront" target="s3-bucket">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="200" y="390" as="sourcePoint" />
            <mxPoint x="200" y="420" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- SPA to API Gateway -->
        <mxCell id="conn3" value="AJAX/Fetch API&#xa;(JavaScript Calls)" style="endArrow=classic;html=1;rounded=0;strokeWidth=4;strokeColor=#d6b656;" edge="1" parent="1" source="s3-bucket" target="api-gateway">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="300" y="500" as="sourcePoint" />
            <mxPoint x="350" y="300" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- API Gateway to Lambda -->
        <mxCell id="conn4" value="AWS_PROXY&#xa;Integration" style="endArrow=classic;html=1;rounded=0;strokeWidth=4;strokeColor=#d6b656;" edge="1" parent="1" source="api-gateway" target="lambda">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="550" y="300" as="sourcePoint" />
            <mxPoint x="660" y="400" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- Lambda to MongoDB -->
        <mxCell id="conn5" value="10.0.1.x:27017&#xa;(Private Network)" style="endArrow=classic;html=1;rounded=0;strokeWidth=3;strokeColor=#82b366;" edge="1" parent="1" source="lambda" target="mongodb">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="840" y="450" as="sourcePoint" />
            <mxPoint x="890" y="540" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- EC2 to MongoDB -->
        <mxCell id="conn6" value="localhost:27017" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#d79b00;" edge="1" parent="1" source="ec2" target="mongodb">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="930" y="460" as="sourcePoint" />
            <mxPoint x="930" y="490" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- Lambda Layer to Lambda -->
        <mxCell id="conn7" value="Attached" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#9673a6;dashed=1;" edge="1" parent="1" source="lambda-layer" target="lambda">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="750" y="510" as="sourcePoint" />
            <mxPoint x="750" y="480" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- IAM Role to Lambda -->
        <mxCell id="conn8" value="Assumes" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#9673a6;dashed=1;" edge="1" parent="1" source="iam-role" target="lambda">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="830" y="620" as="sourcePoint" />
            <mxPoint x="750" y="480" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- Security Group associations -->
        <mxCell id="conn9" value="Applied" style="endArrow=classic;html=1;rounded=0;strokeWidth=1;strokeColor=#b85450;dashed=1;" edge="1" parent="1" source="sg-lambda" target="lambda">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="700" y="620" as="sourcePoint" />
            <mxPoint x="750" y="480" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <mxCell id="conn10" value="Applied" style="endArrow=classic;html=1;rounded=0;strokeWidth=1;strokeColor=#b85450;dashed=1;" edge="1" parent="1" source="sg-ec2" target="ec2">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="960" y="620" as="sourcePoint" />
            <mxPoint x="930" y="460" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- Data Flow Labels -->
        <mxCell id="flow1" value="1. User accesses SPA&#xa;via CloudFront" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=9;fontColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="50" y="120" width="100" height="30" as="geometry" />
        </mxCell>

        <mxCell id="flow2" value="2. Static assets served&#xa;from S3 via CDN" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=9;fontColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="220" y="390" width="100" height="30" as="geometry" />
        </mxCell>

        <mxCell id="flow3" value="3. JavaScript makes&#xa;API calls to Gateway" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=9;fontColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="320" y="350" width="100" height="30" as="geometry" />
        </mxCell>

        <mxCell id="flow4" value="4. Lambda processes&#xa;MongoDB operations" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=9;fontColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="570" y="350" width="100" height="30" as="geometry" />
        </mxCell>

        <mxCell id="flow5" value="5. Response returns&#xa;via same path" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=9;fontColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="570" y="280" width="100" height="30" as="geometry" />
        </mxCell>

        <!-- Outputs Box -->
        <mxCell id="outputs" value="📊 TERRAFORM OUTPUTS:&#xa;&#xa;✅ spa_url:&#xa;https://d123456789.cloudfront.net&#xa;&#xa;✅ api_gateway_invoke_url:&#xa;https://abc123.execute-api.&#xa;us-east-1.amazonaws.com/prod/mongo&#xa;&#xa;✅ s3_bucket_name:&#xa;mongo-spa-xyz12345&#xa;&#xa;✅ cloudfront_domain:&#xa;d123456789.cloudfront.net&#xa;&#xa;✅ ec2_private_ip: 10.0.1.x&#xa;✅ lambda_function_name: mongo-client" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=8;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="350" y="610" width="200" height="140" as="geometry" />
        </mxCell>

        <!-- Architecture Benefits -->
        <mxCell id="benefits" value="🚀 ARCHITECTURE BENEFITS:&#xa;&#xa;🌍 Global CDN Distribution&#xa;⚡ Fast Static Asset Delivery&#xa;🔒 Secure Private Backend&#xa;📱 Responsive Web Interface&#xa;🔄 Real-time CRUD Operations&#xa;💰 Cost-Effective Serverless&#xa;🛡️ HTTPS Everywhere&#xa;🎯 Single Page Application&#xa;📊 MongoDB Dashboard&#xa;🔧 No Server Management" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=8;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="570" y="610" width="150" height="140" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>